<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>4教科特訓演習</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: sans-serif;
  }

  #container {
    text-align: center;
  }
</style>
</head>
<body>

<div id="container">
  <input type="password" id="pw" placeholder="パスワード">
  <button onclick="check()">OK</button>
</div>

<script>
const encryptedData = "Y/nCNBiOWg9CYB23Nt9zR0Rea3vSyNWHq/ny8Xtk/JQrRGLrDnPZ";
const saltBase64 = "B3XX25PSrrmFlyt5lLemwQ==";
const ivBase64 = "d8rV5tbMf9r3WQId";

async function deriveKey(password, salt) {
  const enc = new TextEncoder();

  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    enc.encode(password),
    { name: "PBKDF2" },
    false,
    ["deriveKey"]
  );

  return crypto.subtle.deriveKey(
    {
      name: "PBKDF2",
      salt: salt,
      iterations: 100000,
      hash: "SHA-512"
    },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    false,
    ["decrypt"]
  );
}

async function check() {
  const password = document.getElementById("pw").value;

  try {
    const salt = Uint8Array.from(atob(saltBase64), c => c.charCodeAt(0));
    const iv = Uint8Array.from(atob(ivBase64), c => c.charCodeAt(0));
    const encrypted = Uint8Array.from(atob(encryptedData), c => c.charCodeAt(0));

    const key = await deriveKey(password, salt);

    const decrypted = await crypto.subtle.decrypt(
      { name: "AES-GCM", iv: iv },
      key,
      encrypted
    );

    const url = new TextDecoder().decode(decrypted);

    if (!url.startsWith("http")) throw "error";

    launch(url);

  } catch {
    alert("違います");
  }
}

function launch(url) {
  document.body.innerHTML = "";

  const iframe = document.createElement("iframe");
  iframe.src = url;
  iframe.style.position = "fixed";
  iframe.style.inset = "0";
  iframe.style.border = "none";
  iframe.style.width = "100%";
  iframe.style.height = "100%";

  document.body.appendChild(iframe);
}
</script>

</body>
</html>
